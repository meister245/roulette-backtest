#!/usr/bin/env python3

import sys
import argparse
from os.path import dirname, realpath

SRC_DIR = realpath(dirname(__file__) + '/../')
sys.path.append(SRC_DIR)

from app.config import Config
from app.controller.service import ServiceController

parser = argparse.ArgumentParser()

parser.add_argument('--strategy', action='store', type=str, required=True,
                    help='bet strategy - ex: martingale')
parser.add_argument('--bet_type', action='store', type=str,
                    help='bet types - ex: red,black,half_left,row_top')
parser.add_argument('--bet_amount', action='store', type=float, default=0.20,
                    metavar='NUMBER', help='money to bet on bet types')
parser.add_argument('--balance', action='store', type=float, default=1000.0,
                    metavar='NUMBER', help='starting balance')
parser.add_argument('--cycles', action='store', type=int, default=500,
                    metavar='NUMBER', help='number of games played')
parser.add_argument('--table_limit', action='store', type=int, default=150,
                    metavar='NUMBER', help='maximum sum of bet money table accepts')
parser.add_argument('--backtest', action='store', type=str, default=None,
                    metavar='FILENAME', help='filename for backtesting strategy - ex: sample_numbers')

args = parser.parse_args()

config = Config(SRC_DIR, **vars(args))
service = ServiceController(config)


def start():
    service.run_strategy_test()


if __name__ == '__main__':
    try:
        start()
    except KeyboardInterrupt:
        exit('process terminated by user')
